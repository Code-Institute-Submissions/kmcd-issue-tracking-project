{% extends "base.html" %} {% block content %}

<!-- This form will be used:
     1. To display the details of an issue 
     2. Allow the user to view & enter comments on the issue    -->

<!-- If the user is a vendor-side user, show the name of the client the issue 
     belongs to -->

<!-- Show the rolled up total for the Client -->

{% for client in clienttotal %}
<div class="row no-gutters iss-rep-client-total iss-rep-shadow">

    <div class="col-12 col-md-6 iss-rep-client-code ">
        <span class="pr-2">{{ client.client_code }}:</span>
        <span>{{ client.client_name }}</span>
    </div>

    <div class="col-12 col-md-6 iss-report-align">
        <div class="row no-gutters">
            <div class="col-7 offset-md-3 col-md-6 offset-lg-5 col-lg-5 p-0">
                <span class="pr-2">Input and / or Flagged: </span>
            </div>
            <div class="col-5 col-md-3 col-lg-2 p-0 text-right">
                <span class="pr-2">{{ client.nr_flagged_issues }}</span>

                <!-- The user can click on chevron-down/up to open / close the report
             JS will listen for the class 'show-issues-report' to detect when the chevron has been clicked.
             It will take the client number from the classes (first class) and use it to create the id = '#issues-report-client_code',
             and 'report-open-close-client_code'
                Note that "fa-chevron-down" is used by js in determing whether the report needs to be opened
                 or closed. It expects it to be the 2nd class of the <i> element. So if adding classes, add them
                 at the end. -->

                <span><a class="{{ client.client_code }} show-issues-report btn td-form-font iss-enabled-link iss-chevron-style" href="#"><i  id="report-open-close-{{ client.client_code }}" class="fas fa-chevron-down "></i></a></span>
            </div>
        </div>
    </div>
</div>

<!-- Show the individual issues for the client, but keep them hidden (d-none) -->

<div id="issues-report-{{ client.client_code }}" class="row no-gutters d-none">

    <div class="table-responsive iss-report">

        <table class="table table-striped table-style">
            <thead class="table-hd">
                <tr class="iss-report-th">
                    <th scope="col" class="text-center td-date">#</th>
                    <th scope="col" class="text-center td-username">Author</th>
                    <th scope="col" class="text-center td-sw-comp">Component</th>
                    <th scope="col" class="text-center td-summary">Summary / Details </th>
                    <th class="text-center">Details</th>
                    <th scope="col" class="text-center td-priority">Priority</th>
                    <th scope="col" class="text-center td-status">Status</th>
                </tr>
            </thead>

            <!-- Show issue id, author, component, summary, priority, status -->

            <tbody>

                {% for issue in issues %} {% if issue.client_code == client.client_code %}

                <tr>
                    <td class="td-id">{{ issue.id }}</td>

                    {% if userdetails.user_type == "C" %} {% if userdetails.vend_client_code == issue.author %}
                    <td class="td-username">{{ issue.author }}</td>
                    {% else %}
                    <td class="td-username">******</td>
                    {% endif %} {% else %}

                    <!-- User is on the vendor side - show the Client who raised the issue -->
                    <td class="td-username">{{ issue.author }}</td>

                    {% endif %}


                    <td class="td-sw-comp">{{ issue.software_component }}</td>
                    <td class="td-summary">{{ issue.summary }}</td>

                    <!-- 'show-issue-details' class is used by js for when user clicks on the chevron-down/up. The issue id identifies which 
                                 Issue has been clicked on. The class 'det-chevron-down' is changed to 'det-chevron-up' when 'fa-chevron-down' is
                                 flipped to 'up'. 'det-chevron-up' helps find the details' up chevrons and changes them to down, when the full report is close
                                 -->

                    <td><a class="{{client.client_code}} {{issue.id}} show-issue-details btn td-form-font iss-det-chevron-style" href="#"><i  id="details-open-close-{{client.client_code}}-{{issue.id}}" class="fas fa-chevron-down det-chevron-down-{{client.client_code}}"></i></a></td>
                    <td class="td-priority text-center">{{ issue.priority }}</td>
                    <td class="td-status">{{ issue.status }}</td>
                </tr>

                <!-- The Issue Details are initially hidden (d-none). The user will use the 'chevron-down' to display the details, and 'chevron-up'
                             to hide them -->

                <tr id="issue-details-{{client.client_code}}-{{issue.id}}" class="issue-details-{{ client.client_code }} d-none">

                    <td class="td-id"></td>
                    <td class="td-username"></td>
                    <td class="td-sw-comp "><strong>Issue Details: </strong></td>
                    <td class="">{{ issue.details }}</td>
                    <td></td>
                    <td class="td-priority"></td>
                    <td class="td-status"></td>

                </tr>

                {% endif %} {% endfor %}

            </tbody>
        </table>
        <hr class="iss-hr-style">
    </div>
</div>
{% endfor%} {% endblock %}
